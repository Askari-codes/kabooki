generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Book {
  id                  Int                 @id @default(autoincrement())
  title               String              @db.VarChar(255)
  genre               String              @db.VarChar(100) // Changed from relation to String
  published_at        DateTime
  summary             String?             @db.Text
  cover_url           String?             @db.VarChar(255)
  writers             BooksWriters[]             
  slug                String              @unique(map: "Book_slug_key") @db.VarChar(255)
  rating              Int
  min_price           Float
  is_the_best         Boolean             @default(false)    
  pdf_url             String?
  user_favorite_books UserFavoriteBooks[]
  bookMovies          BookMovies[] 
   relatedFrom         RelatedBook[]       @relation("BookRelatedFrom")
  relatedTo           RelatedBook[]       @relation("BookRelatedTo")
}
model RelatedBook {
  id            Int   @id @default(autoincrement())

  bookId        Int
  relatedBookId Int

  book          Book @relation("BookRelatedFrom", fields: [bookId], references: [id], onDelete: Cascade)
  relatedBook   Book @relation("BookRelatedTo", fields: [relatedBookId], references: [id], onDelete: Cascade)

  @@unique([bookId, relatedBookId])
}
model Movie {
  id                   Int                  @id @default(autoincrement())
  title                String
  related_book_title   String?
  rating               Float
  published_at         DateTime
  summary              String?              @db.Text
  poster               String
  slug                 String               @unique
  stream               String
  directorId           Int?
  director             Director?             @relation(fields: [directorId], references: [id], onDelete: Restrict)
  user_favorite_movies UserFavoriteMovies[]
  MovieGenre           MoviesGenres[]
  bookMovies           BookMovies[]  
}

model BookMovies {
  id        Int      @id @default(autoincrement())
  book_id   Int
  movie_id  Int

  
  book   Book  @relation(fields: [book_id], references: [id], onDelete: Cascade)
  movie  Movie @relation(fields: [movie_id], references: [id], onDelete: Cascade)

  @@unique([book_id, movie_id]) 
}

model Podcast {
  id                     Int                    @id @default(autoincrement())
  title                  String                 @db.VarChar(255)
  genre                  String                 @db.VarChar(100)
  published_at           DateTime
  summary                String?                @db.Text
  cover_url              String?                @db.VarChar(255)
  host_id                Int
  host                   Host                   @relation(fields: [host_id], references: [id], onDelete: Cascade)
  slug                   String                 @unique(map: "Podcast_slug_key") @db.VarChar(255)
  rating                 Int
  min_price              Decimal
  
  user_favorite_podcasts UserFavoritePodcasts[]
}


model Genre {
  id           Int            @id @default(autoincrement())
  name         String
  MoviesGenres MoviesGenres[]
}

model MoviesGenres {
  movie    Movie @relation(fields: [movie_id], references: [id])
  movie_id Int
  genre    Genre @relation(fields: [genre_id], references: [id])
  genre_id Int

  @@id([movie_id, genre_id])
}



model Director {
  id          Int               @id @default(autoincrement())
  name        String            @db.VarChar(255)
  last_name   String            @db.VarChar(255)
  description String?           @db.Text
  picture_url String?           @db.VarChar(255)
  country     String
  slug        String            @unique(map: "Director_slug_key") @db.VarChar(255)
  movies      Movie[]
}

model Writer {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(255)
  last_name   String  @db.VarChar(255)
  description String? @db.Text
  picture_url String? @db.VarChar(255)
  country     String
  slug        String  @unique(map: "Writer_slug_key") @db.VarChar(255)
  nobelist    Boolean @default(false)
  books      BooksWriters[]

  // Reverse relation to RelatedWriters for writer1
  writerRelations1 RelatedWriters[] @relation("WriterRelationsFromWriter1")

  // Reverse relation to RelatedWriters for writer2
  writerRelations2 RelatedWriters[] @relation("WriterRelationsFromWriter2")
}

model RelatedWriters {
  id           Int     @id @default(autoincrement())
  writer_id_1    Int
  writer_id_2    Int
 

  writer1      Writer  @relation("WriterRelationsFromWriter1", fields: [writer_id_1], references: [id])
  writer2      Writer  @relation("WriterRelationsFromWriter2", fields: [writer_id_2], references: [id])

  @@unique([writer_id_1, writer_id_2]) // Ensure no duplicate relationships
}

model BooksWriters {
  book_id   Int
  writer_id Int
  book      Book    @relation(fields: [book_id], references: [id], onDelete: Cascade)
  writer    Writer  @relation(fields: [writer_id], references: [id], onDelete: Cascade)

  @@id([book_id, writer_id])
}

model Host {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(255)
  last_name   String    @db.VarChar(255)
  description String?   @db.Text
  picture_url String?   @db.VarChar(255)
  country     String
  slug        String    @unique(map: "Host_slug_key") @db.VarChar(255)
  podcasts    Podcast[]
}

model User {
  id                     Int                    @id @default(autoincrement())
  user_name              String                 @unique()
  email                  String
  image                  String?
  user_favorite_books    UserFavoriteBooks[]
  user_favorite_podcasts UserFavoritePodcasts[]
  user_favorite_movies   UserFavoriteMovies[]
}

model UserFavoriteBooks {
  id      Int     @id @default(autoincrement())
  rating  Float?
  comment String? @db.Text
  user_Id Int
  book_Id Int
  user    User    @relation(fields: [user_Id], references: [id])
  book    Book    @relation(fields: [book_Id], references: [id])

  @@unique([user_Id, book_Id]) // Composite unique constraint
}

model UserFavoritePodcasts {
  id         Int     @id @default(autoincrement())
  rating     Float?
  comment    String? @db.Text
  user_id    Int
  podcast_id Int
  users      User    @relation(fields: [user_id], references: [id])
  podcasts   Podcast @relation(fields: [podcast_id], references: [id])

  @@unique([user_id, podcast_id]) // Composite unique constraint
}

model UserFavoriteMovies {
  id       Int     @id @default(autoincrement())
  rating   Float?
  comment  String?
  user_id  Int
  movie_id Int
  user     User    @relation(fields: [user_id], references: [id])
  movie    Movie   @relation(fields: [movie_id], references: [id])
}
